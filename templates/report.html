<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <script type="text/javascript" src="static/js/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
    <script src="../static/js/d3.layout.cloud.js"></script>

    <script src="static/js/datamaps.world.min.js"></script>

    <title>Bech - Report</title>

    <!-- Bootstrap Core CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../static/css/landing-page.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation" style="background-color: rgba(0, 0, 0, 0.9); 
            "> 
        <div class="container topnav">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand topnav" style="color:white; font-size: 30px" href="/">Becho</a>
            </div>

        </div>
        <!-- /.container -->
    </nav>

    <div style="height:10px; width:100%"></div> <!-- spacer -->

    <!-- Report -->
    <div class="content-section-a">

        <div class="container">
            <div class="row">
                <div class="col-lg-5 col-sm-6">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Monthly Subscriber's Report: Microsoft</h2>
                    <p class="lead">Microsoft gains a lot of support ahead of it's top competitor Apple's botched anouncement of it's new product, the iPen stylus, which leaves much to be desired in terms of comfort, style and smoothness. It's stock is expected to appreciate as people turn to the Surface Pro, away from the IPad.</p>
                </div>
                <div id="map" class="col-lg-5 col-lg-offset-1 col-sm-6">
                </div>
            </div>

        </div>
        <!-- /.container -->
         <div class="container">
            <div class="row">
                <div id="cloud" class="col-lg-5 col-sm-6"></div>
                <div class="col-lg-5 col-lg-offset-1 col-sm-6">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Trending Topics</h2>
                    <p class="lead">Outlooks look good as users rave around Microsoft's new product announcements. Trending topics include Microsoft organization, the new Pro 4, the Xbox Two, and Microsoft's new 'Save the Rainforest' iniative.</p>
                </div>
            </div>
        </div>
         <!-- /.container -->
         <div class="container">
            <div class="row">
                <div class="col-lg-5 col-lg-offset-1 col-sm-6">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Sentiment Score</h2>
                    <p class="lead">Overall, the public is very happy with Microsoft, from their product anouncements to final deliverables.</p>
                </div>
                <div class="visual-box" class="col-lg-5 col-sm-6"></div>
            </div>
        </div>


    </div>
    <!-- /.content-section-a -->

    </div>
    <!-- /.content-section-a -->
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li>
                            <a href="#">Home</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="#about">About</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="#services">Services</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="#contact">Contact</a>
                        </li>
                    </ul>
                    <p class="copyright text-muted small">Copyright &copy; Becho Inc. 2015. All Rights Reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="../static/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../static/js/bootstrap.min.js"></script>

    <script type="text/javascript">
        var quandleAPIKey = 'feJ8YG6ou5am4bEoVp5Z';
        
        var colors = d3.scale.ordinal()
                      .range(['#99E699', '#5CD65C', '#2EB82E', '#1F7A1F', '#145214']);
        var map = new Datamap({
            height: 350,
            width: 500,
            element: document.getElementById('map')});
        
    map.updateChoropleth({
        USA: colors(Math.random() * 10),
        PRK: colors(Math.random() * 10),
        RUS: colors(Math.random() * 10),
        BRA: colors(Math.random() * 10),
        CAN: colors(Math.random() * 10),
        ZAF: colors(Math.random() * 30),
        IND: colors(Math.random() * 10),
        DEU: colors(Math.random() * 30),
        PAK: colors(Math.random() * 50),
        SSD: colors(Math.random() * 30)
      });

    function pieChart(data){
        var HEIGHT=200;
        var WIDTH=200;
        var radius=Math.min(HEIGHT,WIDTH)/2;
        var color = ['#00ff00','#FFBF00','#8B0000'];
        var percentageFormat = d3.format("%");
        
        var svg = d3.select('.visual-box')
        .append('svg')
        .attr('width', WIDTH)
        .attr('height', HEIGHT)
        .append('g')
        .attr('transform', 'translate('+(WIDTH/2)+','+(HEIGHT/2)+')'); 
        
        var arc = d3.svg.arc().outerRadius(radius).innerRadius(0);
        
        var pie = d3.layout.pie()
                    .value(function(d){return d})
                    .sort(null);
        
        var g = svg.selectAll('.arc')
                   .data(pie(data))
                   .enter().append("g")
                   .attr("class", "arc");
        
        g.append("path")
                    .attr("d", arc)
                    .style("fill", function(d,i) {
                        return color[i];
                    });
        
        var total = d3.sum(data, function(d){ 
                    return d;
        });
        console.log(total);

        g.append('text').attr("transform",function(d,i){return "translate("+arc.centroid(d,i)+")"})
                        .attr("text-anchor", "middle")
                        .text(function(d){return percentageFormat(d.value/total)});
        
    }


    function getWords(word){
        var url="http://159.203.133.16/wordcloud/"+word;
        $.get(url,function(d){
            wordCloud(d);
        });
    }

    var WIDTH=300;
    var HEIGHT=300;

    function wordCloud(data){
        d3.layout.cloud().size([WIDTH,HEIGHT])
          .words(data.map(function(d){return {text: d[0], size: d[1]}}))
          .rotate(function(){return ~~(Math.random()*2)* 90})
          .font("Impact")
          .fontSize(function(d){return d.size})
          .on("end",draw)
          .start();
    }

    function draw(words) {
        var color = d3.scale.category10();
        d3.select("#cloud").append("svg")
          .attr("width", WIDTH)
          .attr("height", HEIGHT)
          .append("g")
          .attr("transform", "translate("+(WIDTH/2)+","+(HEIGHT/2)+")")
          .selectAll("text")
          .data(words)
          .enter().append("text")
          .style("font-size", function(d){return d.size + "px"})
          .style("font-family", "Impact")
          .style("fill", function(d, i){return color(i)})
          .attr("text-anchor", "middle")
          .attr("transform", function(d){
            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")"
        })
          .text(function(d) { return d.text; });
    }
    getWords("Microsoft");
    $.get('http://159.203.133.16/sentiment/microsoft', function(data) {
	var average = 0;
	var count=[0,0,0];
        for(var i=0;i<data.length;i++){
            average+=data[i];
            if(data[i]>0&&data[i]<1){
                count[0]+=1;
            }
            else if(data[i]==0){
                count[1]+=1;
            }
            else{
                count[2]+=1
            }
        }
        average=average/parseFloat(data.length);
        $('#score').html(average);
        pieChart(count);
    });
    </script>

</body>

</html>
